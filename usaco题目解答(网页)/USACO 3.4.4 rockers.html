<html>
<head>
  <title>USACO 3.4.4 rockers</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/268868 (zh-CN); Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="688"/>
<h1>USACO 3.4.4 rockers</h1>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="Arial"><span style="font-size:13pt"><b>[</b></span></font><font color="#010101" face="宋体"><span style="font-size:13pt"><b>解题报告</b></span></font> <font color="#010101" face="Arial"><span style="font-size:13pt"><b>]</b></span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="宋体"><span style="font-size:12pt">混合型动态规划</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">:</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">假设我们已经有一个</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">reg[i][j]</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">代表从</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">i</span></font> <font color="#010101" face="宋体"><span style="font-size:12pt">到</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">j</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">的可行最大数量</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">那么我们对于整个序列来说只要算出</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">dp[i][j]</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">代表前</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">i</span></font> <font color="#010101" face="宋体"><span style="font-size:12pt">个背包选前</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">j</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">个曲子的最大值</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">就相当于把序列分成</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">M</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">段</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">取最大值</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">类似石子归并类的划分问题</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">.</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">因此我们先用</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">01</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">背包计算出</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">reg[i][j]</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">的那个区间的最优值</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">.</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">然后使用方程</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">:DP[i][j]=MAX{DP[i-1][k]+reg[k+1][j]}</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">计算</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">,DP[m][n]</span></font> <font color="#010101" face="宋体"><span style="font-size:12pt">即为所求</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">.</span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="Arial"><span style="font-size:12pt">USACO</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">官方的题解很不错</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">:dp[a][b][c]</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">表示前</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">a</span></font> <font color="#010101" face="宋体"><span style="font-size:12pt">个包</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">已经录了</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">b</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">分钟</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">录到</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">c</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">个曲子的最大值</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">.</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">因为我们一旦可以在当前</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">a</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">个包内放得下曲子就没理由放到第</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">(a+1)</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">个包中</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">同样一旦放不下就只能放到</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">(a+1)</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">个包中了</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">.</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">具体请看下面的代码<br></span></font> <font color="#010101" face="Arial" size="2"><span style="font-size:10pt">for (a = 0; a &lt; numcds; a++)/* current cd */<br>
    for (b = 0; b &lt;= cdlength; b++) /* number of minutes used */<br>
        for (c = 0; c &lt;= numsongs; c++) { /* last song */<br>
            for (d = c + 1; d &lt;= numsongs; d++) { /* new song */<br>
            if (b + length[d] &lt;= cdlength) {<br>
            if (dp[a][b][c] + 1 &gt; dp[a][b + length[d]][d])<br>
                dp[a][b + length[d]][d] = dp[a][b][c] + 1;<br>
            }<br>
            else {<br>
            if (dp[a][b][c] + 1 &gt; dp[a + 1][length[d]][d])<br>
                dp[a + 1][length[d]][d] = dp[a][b][c] + 1;<br>
            }   <br>
        }<br>
        if (dp[a][b][c] &gt; best)<br>
            best = dp[a][b][c];<br>
}</span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="Arial"><span style="font-size:13pt"><b>[</b></span></font><font color="#010101" face="宋体"><span style="font-size:13pt"><b>运行情况</b></span></font> <font color="#010101" face="Arial"><span style="font-size:13pt"><b>]</b></span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="Arial" size="2"><span style="font-size:10pt">Compiling... <br>
Compile: OK</span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="Arial" size="2"><span style="font-size:10pt">Executing...<br>
   Test 1: TEST OK [0.000 secs, 2932 KB]<br>
   Test 2: TEST OK [0.011 secs, 2932 KB]<br>
   Test 3: TEST OK [0.011 secs, 2932 KB]<br>
   Test 4: TEST OK [0.011 secs, 2932 KB]<br>
   Test 5: TEST OK [0.011 secs, 2932 KB]<br>
   Test 6: TEST OK [0.022 secs, 2932 KB]<br>
   Test 7: TEST OK [0.011 secs, 2932 KB]<br>
   Test 8: TEST OK [0.000 secs, 2932 KB]<br>
   Test 9: TEST OK [0.011 secs, 2932 KB]<br>
   Test 10: TEST OK [0.000 secs, 2932 KB]<br>
   Test 11: TEST OK [0.000 secs, 2932 KB]<br>
   Test 12: TEST OK [0.011 secs, 2932 KB]</span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="Arial" size="2"><span style="font-size:10pt">All tests OK.<br></span><span style="font-size:10pt"><b>YOUR PROGRAM ('rockers') WORKED FIRST TIME!</b></span><span style="font-size:10pt"> That's fantastic<br>
-- and a rare thing. Please accept these special automated<br>
congratulations.</span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="Arial"><span style="font-size:13pt"><b>[</b></span></font><font color="#010101" face="宋体"><span style="font-size:13pt"><b>程序清单</b></span></font> <font color="#010101" face="Arial"><span style="font-size:13pt"><b>]</b></span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">#include</span></font> <font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">&lt;fstream&gt;</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">#define</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">MAX(a,b) ((a)&gt;(b)?(a):(b))</span></font><font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//双重DP</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">using</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">namespace</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">std;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">ofstream fout (</span></font><font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">&quot;rockers.out&quot;</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">,ios::out);</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">ifstream fin (</span></font><font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">&quot;rockers.in&quot;</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">,ios::in);</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">long</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">dp[21][21],reg[21][21],pack[21],v[21],n,t,m;</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">main()</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">{</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">    fin&gt;&gt;n&gt;&gt;t&gt;&gt;m;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">i=1;i&lt;=n;i++) fin&gt;&gt;v[i];</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">k=0;k&lt;n;k++)</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">       </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">K=1;K&lt;=n-k;K++){</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">           </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">i=K;i&lt;=K+k;i++)</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">               </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">j=t;j&gt;=1;j--)</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">               </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(j-v[i]&gt;=0) pack[j]=MAX(pack[j],pack[j-v[i]]+1);</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">                   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">else</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">pack[j]=pack[j];</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">            reg[K][K+k]=pack[t];</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">           </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">p=0;p&lt;=t;p++) pack[p]=0;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">        }</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">i=1;i&lt;=n;i++) dp[1][i]=reg[1][i];</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">k=1;k&lt;=n;k++)</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">       </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">i=2;i&lt;=m;i++)</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">           </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">j=1;j&lt;=n;j++)</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">                dp[i][j]=MAX(dp[i-1][k]+reg[k+1][j],dp[i][j]);</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt"><br></span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">    fout&lt;&lt;dp[m][n]&lt;&lt;endl;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">return</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">0;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">}</span></font></div></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="Arial"><span style="font-size:13pt"><b>[</b></span></font><font color="#010101" face="宋体"><span style="font-size:13pt"><b>注意事项</b></span></font> <font color="#010101" face="Arial"><span style="font-size:13pt"><b>]</b></span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">注意初始化</span></font><font color="#010101" face="Arial" size="2"><span style="font-size:10pt">!</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">在计算时可能</span></font> <font color="#010101" face="Arial" size="2"><span style="font-size:10pt">(m&gt;n),</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">因此方程不必判断合法性</span></font> <font color="#010101" face="Arial" size="2"><span style="font-size:10pt">,</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">这样在某种程度上方程就会继承上一个值</span></font> <font color="#010101" face="Arial" size="2"><span style="font-size:10pt">,</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">或者特殊判断给定专门的严格继承也行</span></font> <font color="#010101" face="Arial" size="2"><span style="font-size:10pt">.</span></font></div><div align="justify"><font color="#010101" face="Arial"><span style="font-size:13pt"><b>[</b></span></font><font color="#010101" face="宋体"><span style="font-size:13pt"><b>难易等级</b></span></font><font color="#010101" face="Arial"><span style="font-size:13pt"><b>] </b></span></font><font color="#010101" face="Arial" size="2"><span style="font-size:10pt"><b>Midele down(noip the 3rd)</b></span></font></div></div>
</div></body></html> 