<html>
<head>
  <title>USACO 5.4.1 latin</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/268868 (zh-CN); Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1830"/>
<h1>USACO 5.4.1 latin</h1>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>解题报告</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><div align="left" style="text-indent: 0mm; margin: 4.75mm 0mm;"><font color="#010101" face="宋体" size="4">题目要求计算出一个nxn的拉丁方所有的数目，限制条件是第一行是1,2,3...N。单纯的DFS对于7以上的测试点很慢，我们要考虑一些剪枝：<br>
1.假设一个nxn的拉丁方在固定第一行和第一列的情况下的构造数目是L[n],那么解除第一列的固定后总数目是L[n]*(n-1)!。理由是第二行到最后一行排列组合也可以重新组成新的拉丁方。这样也就不必要对第一列构造了，令第一列也是1,2...N即可，也就是实质上我们的搜索是从[2,2]开始的。<br>
2.最后一行不用构造，如果搜索完N-1行，到达第N行，那么一定存在解。<br>
3.置换群优化，如下：</font></div><div align="left" style="text-indent: 0mm; margin: 4.75mm 0mm;"><span style="text-indent: 0mm;"><font color="#010101" face="宋体" size="4">ROW</font><br><font color="#010101" face="宋体" size="4">1      12345</font><br></span><span style="text-indent: 0mm;"><font color="#010101" face="宋体" size="4">2      32154 ----&gt; 存在两个置换(1,2,3)和(4,5)</font></span></div><div align="left" style="text-indent: 0mm; margin: 4.75mm 0mm;"><span style="text-indent: 0mm;"><font color="#010101" face="宋体" size="4">1      </font></span><font color="#010101" face="宋体" size="4">12345<br></font><font color="#010101" face="宋体" size="4" style="text-indent: 0mm;">2      21453 ----&gt; </font><span style="text-indent: 0mm; color: rgb(1, 1, 1); font-family: 宋体; font-size: large;">存在两个置换(1,2)和(3,4,5)</span></div><div align="left" style="text-indent: 0mm; margin: 4.75mm 0mm;"><font color="#010101" face="宋体" size="4">上面两个置换最后得到的解的总数是一样的，有了这个理论后，我们就可以用个Hash来存储不同的置换群，以后每次DFS时先找到前两行的置换是否有搜索过的，如果有则直接累加就可以了。</font></div></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>运行情况</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><pre style="text-align: start;"></pre><pre>
Compiling...
Compile: OK

Executing...
   Test 1: TEST OK [0.000 secs, 3228 KB]
   Test 2: TEST OK [0.000 secs, 3228 KB]
   Test 3: TEST OK [0.000 secs, 3228 KB]
   Test 4: TEST OK [0.000 secs, 3228 KB]
   Test 5: TEST OK [0.000 secs, 3228 KB]
   Test 6: TEST OK [0.313 secs, 3228 KB]

All tests OK.
<br><b>YOUR PROGRAM ('latin') WORKED FIRST TIME!</b>  That's fantastic
-- and a rare thing.  Please accept these special automated
congratulations.
</pre></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>程序清单</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><div align="left"><pre style="line-height: 12pt; font-size: 13px; background-color: rgb(255, 255, 236);"></pre><div dir="ltr" lang="zh-cn" style="direction: ltr; text-align: start; font-family: Verdana, Arial, sans-serif;"><div dir="ltr" style="text-align: left;"><div style="font-family: monospace;"><pre style="line-height: 12pt;"></pre><div><pre style="font-size: 13px; line-height: 12pt; background-color: rgb(255, 255, 236);"></pre><pre style="line-height: 12pt;"><span style="color: rgb(51, 153, 0);">#include &lt;iostream&gt;
</span><span style="color: rgb(51, 153, 0);">#include &lt;cstring&gt;
</span><span style="color: rgb(51, 153, 0);">#include &lt;cstdio&gt;
</span><span style="color: rgb(51, 153, 0);">#include &lt;string&gt;</span>
 
<span style="color: rgb(0, 0, 255);">using</span> <span style="color: rgb(0, 0, 255);">namespace</span> std<span style="color: rgb(0, 128, 128);">;</span>
 
<span style="color: rgb(0, 0, 255);">typedef</span> <span style="color: rgb(0, 0, 255);">long</span> <span style="color: rgb(0, 0, 255);">long</span> INT64<span style="color: rgb(0, 128, 128);">;</span>
 
<span style="color: rgb(0, 0, 255);">int</span> n, tot<span style="color: rgb(0, 128, 0);">[</span><span style="color: rgb(0, 0, 221);">8</span><span style="color: rgb(0, 128, 0);">]</span>, mat<span style="color: rgb(0, 128, 0);">[</span><span style="color: rgb(0, 0, 221);">8</span><span style="color: rgb(0, 128, 0);">]</span>, qun<span style="color: rgb(0, 128, 128);">;</span>
INT64 jc<span style="color: rgb(0, 128, 0);">[</span><span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 128, 0);">{</span><span style="color: rgb(0, 0, 221);">0</span>, <span style="color: rgb(0, 0, 221);">1</span>, <span style="color: rgb(0, 0, 221);">2</span>, <span style="color: rgb(0, 0, 221);">6</span>, <span style="color: rgb(0, 0, 221);">24</span>, <span style="color: rgb(0, 0, 221);">120</span>, <span style="color: rgb(0, 0, 221);">720</span>, <span style="color: rgb(0, 0, 221);">5040</span><span style="color: rgb(0, 128, 0);">}</span>, total<span style="color: rgb(0, 128, 128);">;
</span><span style="color: rgb(0, 0, 255);">bool</span> col<span style="color: rgb(0, 128, 0);">[</span><span style="color: rgb(0, 0, 221);">8</span><span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span><span style="color: rgb(0, 0, 221);">8</span><span style="color: rgb(0, 128, 0);">]</span>, row<span style="color: rgb(0, 128, 0);">[</span><span style="color: rgb(0, 0, 221);">8</span><span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span><span style="color: rgb(0, 0, 221);">8</span><span style="color: rgb(0, 128, 0);">]</span>, f<span style="color: rgb(0, 128, 0);">[</span><span style="color: rgb(0, 0, 221);">8</span><span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 128);">;</span> <span style="color: rgb(102, 102, 102);">//表示第n行(列)的数字m有无被占用。</span>
 
<span style="color: rgb(0, 0, 255);">inline</span> <span style="color: rgb(0, 0, 255);">int</span> find_qun<span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">{</span>
        <span style="color: rgb(0, 0, 255);">int</span> id <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">2</span>, lar, t<span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 221);">memset</span><span style="color: rgb(0, 128, 0);">(</span>f, <span style="color: rgb(0, 0, 221);">0</span>, <span style="color: rgb(0, 0, 221);">sizeof</span><span style="color: rgb(0, 128, 0);">(</span>f<span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 255);">int</span> i <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span>  i <span style="color: rgb(0, 0, 128);">&lt;=</span> n<span style="color: rgb(0, 128, 128);">;</span> i<span style="color: rgb(0, 0, 64);">++</span><span style="color: rgb(0, 128, 0);">)</span>
                <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 64);">!</span>f<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">{</span>
                        lar <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">0</span>, t <span style="color: rgb(0, 0, 128);">=</span> i<span style="color: rgb(0, 128, 128);">;</span>
                        <span style="color: rgb(0, 0, 255);">do</span><span style="color: rgb(0, 128, 0);">{</span>
                                f<span style="color: rgb(0, 128, 0);">[</span>t<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 255);">true</span>, lar<span style="color: rgb(0, 0, 64);">++</span>, t <span style="color: rgb(0, 0, 128);">=</span> mat<span style="color: rgb(0, 128, 0);">[</span>t<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 128);">;</span>
                        <span style="color: rgb(0, 128, 0);">}</span><span style="color: rgb(0, 0, 255);">while</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 64);">!</span>f<span style="color: rgb(0, 128, 0);">[</span>t<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
                        <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span>lar <span style="color: rgb(0, 0, 128);">&gt;</span> id<span style="color: rgb(0, 128, 0);">)</span> id <span style="color: rgb(0, 0, 128);">=</span> lar<span style="color: rgb(0, 128, 128);">;</span>
                <span style="color: rgb(0, 128, 0);">}</span>
        <span style="color: rgb(0, 0, 255);">return</span> id<span style="color: rgb(0, 128, 128);">;
</span><span style="color: rgb(0, 128, 0);">}</span>
 
<span style="color: rgb(0, 0, 255);">void</span> solve<span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 255);">int</span> r, <span style="color: rgb(0, 0, 255);">int</span> c<span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">{</span>
        <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 128, 0);">(</span>r <span style="color: rgb(0, 0, 128);">==</span> n<span style="color: rgb(0, 128, 0);">)</span> <span style="color: rgb(0, 0, 64);">&amp;&amp;</span> <span style="color: rgb(0, 128, 0);">(</span>c <span style="color: rgb(0, 0, 128);">==</span> <span style="color: rgb(0, 0, 221);">2</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">)</span>
                <span style="color: rgb(0, 0, 64);">++</span>tot<span style="color: rgb(0, 128, 0);">[</span>qun<span style="color: rgb(0, 128, 0);">]</span>, <span style="color: rgb(0, 0, 64);">++</span>total<span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 255);">int</span> j <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span> j <span style="color: rgb(0, 0, 128);">&lt;=</span> n<span style="color: rgb(0, 128, 128);">;</span> j<span style="color: rgb(0, 0, 64);">++</span><span style="color: rgb(0, 128, 0);">)</span>
                <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 64);">!</span>col<span style="color: rgb(0, 128, 0);">[</span>c<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>j<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 64);">&amp;&amp;</span> <span style="color: rgb(0, 0, 64);">!</span>row<span style="color: rgb(0, 128, 0);">[</span>r<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>j<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">{</span>
                        col<span style="color: rgb(0, 128, 0);">[</span>c<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>j<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 128);">=</span> row<span style="color: rgb(0, 128, 0);">[</span>r<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>j<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 255);">true</span><span style="color: rgb(0, 128, 128);">;</span>
                        <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span>r <span style="color: rgb(0, 0, 128);">==</span> <span style="color: rgb(0, 0, 221);">2</span><span style="color: rgb(0, 128, 0);">)</span> mat<span style="color: rgb(0, 128, 0);">[</span>c<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 128);">=</span> j<span style="color: rgb(0, 128, 128);">;</span>
                        <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span>c <span style="color: rgb(0, 0, 128);">==</span> n<span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">{</span>
                                <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span>r <span style="color: rgb(0, 0, 128);">==</span> <span style="color: rgb(0, 0, 221);">2</span><span style="color: rgb(0, 128, 0);">)</span> qun <span style="color: rgb(0, 0, 128);">=</span> find_qun<span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
                                <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span>r <span style="color: rgb(0, 0, 128);">==</span> <span style="color: rgb(0, 0, 221);">2</span> <span style="color: rgb(0, 0, 64);">&amp;&amp;</span> tot<span style="color: rgb(0, 128, 0);">[</span>qun<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">)</span> total <span style="color: rgb(0, 0, 64);">+</span><span style="color: rgb(0, 0, 128);">=</span> tot<span style="color: rgb(0, 128, 0);">[</span>qun<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 128);">;</span>
                                <span style="color: rgb(0, 0, 255);">else</span> solve<span style="color: rgb(0, 128, 0);">(</span>r <span style="color: rgb(0, 0, 64);">+</span> <span style="color: rgb(0, 0, 221);">1</span>, <span style="color: rgb(0, 0, 221);">2</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
                        <span style="color: rgb(0, 128, 0);">}</span>
                        <span style="color: rgb(0, 0, 255);">else</span>
                                solve<span style="color: rgb(0, 128, 0);">(</span>r, c <span style="color: rgb(0, 0, 64);">+</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
                        col<span style="color: rgb(0, 128, 0);">[</span>c<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>j<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 128);">=</span> row<span style="color: rgb(0, 128, 0);">[</span>r<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>j<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 255);">false</span><span style="color: rgb(0, 128, 128);">;</span>
                <span style="color: rgb(0, 128, 0);">}</span>       
<span style="color: rgb(0, 128, 0);">}</span>
 
<span style="color: rgb(0, 0, 255);">int</span> main<span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">{</span>
        <span style="color: rgb(0, 0, 221);">freopen</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(255, 0, 0);">&quot;latin.in&quot;</span>, <span style="color: rgb(255, 0, 0);">&quot;r&quot;</span>, <span style="color: rgb(0, 0, 255);">stdin</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 221);">freopen</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(255, 0, 0);">&quot;latin.out&quot;</span>, <span style="color: rgb(255, 0, 0);">&quot;w&quot;</span>, <span style="color: rgb(0, 0, 255);">stdout</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 221);">cin</span> <span style="color: rgb(0, 0, 128);">&gt;&gt;</span> n<span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 255);">int</span> i <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span> i <span style="color: rgb(0, 0, 128);">&lt;=</span> n<span style="color: rgb(0, 128, 128);">;</span> i<span style="color: rgb(0, 0, 64);">++</span><span style="color: rgb(0, 128, 0);">)</span>
                col<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 128);">=</span> row<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 255);">true</span><span style="color: rgb(0, 128, 128);">;</span>
        mat<span style="color: rgb(0, 128, 0);">[</span><span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">2</span><span style="color: rgb(0, 128, 128);">;</span>
        solve<span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 221);">2</span>, <span style="color: rgb(0, 0, 221);">2</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 221);">cout</span> <span style="color: rgb(0, 0, 128);">&lt;&lt;</span> total <span style="color: rgb(0, 0, 64);">*</span> jc<span style="color: rgb(0, 128, 0);">[</span>n <span style="color: rgb(0, 0, 64);">-</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 128);">&lt;&lt;</span> endl<span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 255);">return</span> <span style="color: rgb(0, 0, 221);">0</span><span style="color: rgb(0, 128, 128);">;
</span><span style="color: rgb(0, 128, 0);">}</span></pre></div></div></div></div></div></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>注意事项</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><font color="#010101" face="宋体">无</font></div><div align="justify"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>难易等级</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font><font color="#010101" size="2"><span style="font-size: 10pt;"><b><font face="黑体"> Medium Up(省选 the 2nd)</font></b></span></font></div></div>
</div></body></html> 