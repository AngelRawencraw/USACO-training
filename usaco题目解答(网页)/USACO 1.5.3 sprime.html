<html>
<head>
  <title>USACO 1.5.3 sprime</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/268868 (zh-CN); Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="434"/>
<h1>USACO 1.5.3 sprime</h1>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size:13pt"><b>解题报告</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="宋体"><span style="font-size:12pt">首先先构造数字</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">首位只能有</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">{2,3,5,7}</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">满足要求</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">,</span></font> <font color="#010101" face="宋体"><span style="font-size:12pt">中间的只能有</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">{1,3,7,9},</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">末尾也只能有</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">{1,3,7,9},</span></font> <font color="#010101" face="宋体"><span style="font-size:12pt">这是因为</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">2,4,6,8</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">必定为非素数</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">而中间与末尾接</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">5</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">会被</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">5</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">整除</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">首位不能有</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">1,1</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">不是素数</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">但中间与末尾可以</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">.</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">然后使用</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">DFS,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">其中要判断并剪枝</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">.(77</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">是非素</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">需判断</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">),</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">同时还需构造状态</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">就是把数字乘出来</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">然后判断并搜索</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">.</span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size:13pt"><b>运行情况</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="Arial" size="2"><span style="font-size:10pt">Compiling...<br>
Compile: OK</span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="Arial" size="2"><span style="font-size:10pt">Executing...<br>
   Test 1: TEST OK [0.011 secs, 2928 KB]<br>
   Test 2: TEST OK [0.011 secs, 2928 KB]<br>
   Test 3: TEST OK [0.011 secs, 2928 KB]<br>
   Test 4: TEST OK [0.011 secs, 2928 KB]<br>
   Test 5: TEST OK [0.000 secs, 2928 KB]</span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="Arial" size="2"><span style="font-size:10pt">All tests OK.<br></span><span style="font-size:10pt"><b>YOUR PROGRAM ('sprime') WORKED FIRST TIME!</b></span><span style="font-size:10pt"> That's fantastic<br>
-- and a rare thing. Please accept these special automated<br></span><span style="font-size:10pt"><b>congratulations.</b></span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size:13pt"><b>程序清单</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font></div><p style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:4.22mm;"></p><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">#include</span></font> <font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">&lt;fstream&gt;</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">#include</span></font><font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">&lt;cmath&gt;</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">using</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">namespace</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">std;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">ofstream fout (</span></font><font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">&quot;sprime.out&quot;</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">,ios::out);</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">ifstream fin (</span></font><font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">&quot;sprime.in&quot;</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">,ios::in);</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">n,sum[9],ju[2][4]={{2,3,5,7},{1,3,7,9}};</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">bool</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">prime(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">a)</span></font> <font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//素数检查</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">{</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt"><br></span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">i=2;i&lt;=sqrt(a);i++)</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">  </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">(a%i==0)</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">return</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">false</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">;</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">return</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">true</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">}</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">dfs(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">temp,</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">ad)</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">{</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">pos=0,ad2=ad;</span></font><font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//ad2记录当前状态.</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">(temp&gt;n)</span></font><font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//记录层次</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">{</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   fout&lt;&lt;ad&lt;&lt;endl;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">  </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">return</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">0;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">}</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(temp==1) pos=0;</span></font><font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//判断首尾</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">  </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">else</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">pos=1;</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">k=0;k&lt;4;k++)</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">{</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   sum[temp]=ju[pos][k];</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   ad=ad*10+sum[temp];</span></font> <font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//构造状态</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">  </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(temp!=1)</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">  </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">(!prime(ad)||((sum[temp-1]==7)&amp;&amp;(sum[temp==7]))) {ad=ad2;</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">continue</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">;}</span></font><font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//剪枝</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">else</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">     dfs(temp+1,ad);</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">  </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">else</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   {</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">    ad=sum[temp];</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">    dfs(temp+1,ad);</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   }</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   ad=ad2;</span></font><font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//回溯</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">}</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">}</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">main()</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">{</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">    fin&gt;&gt;n;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">    dfs(1,0);</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">return</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">0;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">}</span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size:13pt"><b>注意事项</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">注意剪枝</span></font><font color="#010101" face="Arial" size="2"><span style="font-size:10pt">.</span></font></div><div align="justify"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size:13pt"><b>难易等级</b></span></font></font><font color="#010101"><span style="font-size: 13pt;"><b><font face="黑体">]</font><font face="Arial"> </font></b></span></font><font color="#010101" face="Arial" size="2"><span style="font-size:10pt"><b>Easy Up(noip the 2nd)</b></span></font></div></div>
</div></body></html> 