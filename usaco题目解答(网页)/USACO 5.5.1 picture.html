<html>
<head>
  <title>USACO 5.5.1 picture</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/268868 (zh-CN); Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1912"/>
<h1>USACO 5.5.1 picture</h1>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>解题报告</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><div align="left" style="text-indent: 0mm; margin: 4.75mm 0mm;"><div><font color="#010101" face="宋体" size="4">其实边界需要统计的是上下左右4个方向没有被覆盖到的边长的总和。这个问题的难点是怎样使得需要判断检索重叠的复杂度尽量小，我们先简化问题，假设所有矩形都是A情况的，也就是宽度都一样并且垂直排列，这样的话我们就将矩形的情况分为不相交，交叠，包含几种情况。先从横向的边开始看，如图所示，如果只考虑蓝色和浅绿色这两个矩形因为没有任何与其相交的其他矩形，直接统计横向边长，然而交叠和包含要怎么办呢。如图红色和黄色的矩形有橙色的部分，那么也就是说我们只用统计红色的上边长和黄色的下边长了。而浅蓝色和紫色的关系也是类似只用统计紫色的两个边。</font></div><div><font color="#010101" face="宋体" size="4"><br></font></div><div><font color="#010101" face="宋体" size="4">从这里我们得到一些启发，假设所有边长都是1个单位长度，显然我们只是统计一个覆盖域的上下两个边界，那么这从抽象意义上很类似括号匹配的问题，下面的这些矩形块可以抽象成</font><font color="#0000FF" face="宋体" size="4" style="font-weight: bold;">()</font><font color="#00FF00" face="宋体" size="4" style="font-weight: bold;">()</font><font color="#FF0000" face="宋体" size="4" style="font-weight: bold;">(</font><font color="#FFFF00" face="宋体" size="4" style="font-weight: bold;">(</font><font color="#FF0000" face="宋体" size="4" style="font-weight: bold;">)</font><font color="#FFFF00" face="宋体" size="4" style="font-weight: bold;">)</font><font color="#800080" face="宋体" size="4" style="font-weight: bold;">(</font><font color="#00FFFF" face="宋体" size="4" style="font-weight: bold;">()</font><font face="宋体" size="4"><b style="color: rgb(128, 0, 128);">)</b>注意观察它们的特点，可以发现跟真实的配对没有关系，也就是()()(())(())，我们用一个栈依次压入括号，每次出现()的配对就出栈。然后要统计这些，当压入后(且栈只有这一个元素)时计数器加一，当弹出元素后栈空时计数器加一。这样我们就相当于统计出了所有的该纳入计算的边界，由这个思考点出发，我们要对所有的矩形边进行离散化，同时要区别上下边界，抽象成“左右括号”。这个时候有个细节，对于横向边我们按纵标排序，如果纵标一样谁在前？其实这也是交叠的一种情况，如果纵标一样，先要把左括号排在前，也就是如果我们按纵标由小到大排，下边界应在前，不然会使得周长变大。</font></div><div><font face="宋体" size="4"><br></font></div><div><font face="宋体" size="4">具体实现时我们看B图，因为配对不只是一种情况，而且坐标很大，这时候我们可以使用线段树来辅助数据结构的部分，需要横着纵着处理两次。也就是对于类似括号匹配中栈的操作，真正实现用的是线段树。</font></div><div><font face="宋体" size="4"><br></font></div><div><font face="宋体" size="4">这样本问题就解决了，算法是<b>离散化+线段树</b>。这个算法的正确性是我们已经排好了序，而且每个方向的边都是成对出现的。</font></div><div><font color="#010101" face="宋体" size="4"><br></font></div><div><img src="USACO 5.5.1 picture_files/Untitled.png" type="image/png" height="450" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="682"/><font color="#010101" face="宋体" size="4"><br></font></div></div></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>运行情况</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><pre style="text-align: start;"></pre><pre style="text-align: start;"></pre><pre>
Compiling...
Compile: OK

Executing...
   Test 1: TEST OK [0.011 secs, 5100 KB]
   Test 2: TEST OK [0.011 secs, 5100 KB]
   Test 3: TEST OK [0.011 secs, 5100 KB]
   Test 4: TEST OK [0.011 secs, 5100 KB]
   Test 5: TEST OK [0.011 secs, 5100 KB]
   Test 6: TEST OK [0.011 secs, 5100 KB]
   Test 7: TEST OK [0.043 secs, 5100 KB]
   Test 8: TEST OK [0.011 secs, 5100 KB]
   Test 9: TEST OK [0.043 secs, 5100 KB]
   Test 10: TEST OK [0.011 secs, 5100 KB]
   Test 11: TEST OK [0.259 secs, 5100 KB]

All tests OK.
<br><b>YOUR PROGRAM ('picture') WORKED FIRST TIME!</b>  That's fantastic
-- and a rare thing.  Please accept these special automated
congratulations.
</pre></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>程序清单</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><div align="left"><pre style="line-height: 12pt; font-size: 13px; background-color: rgb(255, 255, 236);"></pre><div dir="ltr" lang="zh-cn" style="direction: ltr; text-align: start;"><div dir="ltr" style="text-align: left;"><pre style="line-height: 12pt;"></pre><div><pre style="font-size: 13px; line-height: 12pt; background-color: rgb(255, 255, 236);"></pre><pre style="line-height: 12pt;"></pre><pre style="background-color: rgb(255, 255, 236);"></pre><pre style="line-height: 12pt; font-size: 13px; background-color: rgb(255, 255, 236);"></pre><pre style="line-height: 12pt;"><span style="color: rgb(51, 153, 0);">#include &lt;iostream&gt;
</span><span style="color: rgb(51, 153, 0);">#include &lt;algorithm&gt;
</span><span style="color: rgb(51, 153, 0);">#include &lt;cstdio&gt;
</span><span style="color: rgb(51, 153, 0);">#include &lt;cstring&gt;
</span><span style="color: rgb(51, 153, 0);">#define MAX(a, b) (a &gt; b ? a : b)
</span><span style="color: rgb(51, 153, 0);">#define recv recvh
</span><span style="color: rgb(51, 153, 0);">#define rech recvh</span>
 
<span style="color: rgb(0, 0, 255);">using</span> <span style="color: rgb(0, 0, 255);">namespace</span> std<span style="color: rgb(0, 128, 128);">;</span>
 
<span style="color: rgb(0, 0, 255);">struct</span> Node<span style="color: rgb(0, 128, 0);">{</span>
        <span style="color: rgb(0, 0, 255);">long</span> lch, rch, l, r, clr, mid, all, tot<span style="color: rgb(0, 128, 128);">;</span>  <span style="color: rgb(102, 102, 102);">//clr表示当前颜色,all表示整体的颜色</span>
        <span style="color: rgb(0, 0, 255);">bool</span> mark<span style="color: rgb(0, 128, 128);">;</span>    <span style="color: rgb(102, 102, 102);">//mark是True时杂色，False则纯色。
</span><span style="color: rgb(0, 128, 0);">}</span>tree<span style="color: rgb(0, 128, 0);">[</span><span style="color: rgb(0, 0, 221);">40005</span><span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 128);">;
</span><span style="color: rgb(0, 0, 255);">struct</span> rectVH<span style="color: rgb(0, 128, 0);">{</span>
        <span style="color: rgb(0, 0, 255);">int</span> s, t, vh, start<span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 255);">bool</span> operator <span style="color: rgb(0, 0, 128);">&lt;</span> <span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 255);">const</span> rectVH <span style="color: rgb(0, 0, 64);">&amp;</span>cmp<span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 0, 255);">const</span> <span style="color: rgb(0, 128, 0);">{</span>
                <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span>vh <span style="color: rgb(0, 0, 128);">==</span> cmp.<span style="color: rgb(0, 119, 136);">vh</span><span style="color: rgb(0, 128, 0);">)</span> <span style="color: rgb(0, 0, 255);">return</span> cmp.<span style="color: rgb(0, 119, 136);">start</span> <span style="color: rgb(0, 0, 128);">&lt;</span> start<span style="color: rgb(0, 128, 128);">;</span>
                <span style="color: rgb(0, 0, 255);">return</span> vh <span style="color: rgb(0, 0, 128);">&lt;</span> cmp.<span style="color: rgb(0, 119, 136);">vh</span><span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 128, 0);">}</span>       
<span style="color: rgb(0, 128, 0);">}</span>recvh<span style="color: rgb(0, 128, 0);">[</span><span style="color: rgb(0, 0, 221);">20005</span><span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 128);">;
</span><span style="color: rgb(0, 0, 255);">long</span> tot <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">1</span>, n, ans<span style="color: rgb(0, 128, 128);">;</span>
 
<span style="color: rgb(0, 0, 255);">class</span> regtree<span style="color: rgb(0, 128, 0);">{</span>
        <span style="color: rgb(0, 0, 255);">public</span><span style="color: rgb(0, 128, 128);">:</span>
                <span style="color: rgb(0, 0, 255);">void</span> build<span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 255);">long</span> left, <span style="color: rgb(0, 0, 255);">long</span> right, <span style="color: rgb(0, 0, 255);">long</span> index<span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">{</span>
                        tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">l</span> <span style="color: rgb(0, 0, 128);">=</span> left<span style="color: rgb(0, 128, 128);">;</span>
                        tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">r</span> <span style="color: rgb(0, 0, 128);">=</span> right<span style="color: rgb(0, 128, 128);">;</span>
                        tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">mid</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 128, 0);">(</span>left <span style="color: rgb(0, 0, 64);">+</span> right<span style="color: rgb(0, 128, 0);">)</span> <span style="color: rgb(0, 0, 64);">/</span> <span style="color: rgb(0, 0, 221);">2</span><span style="color: rgb(0, 128, 128);">;</span>
                        tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">all</span> <span style="color: rgb(0, 0, 128);">=</span> right <span style="color: rgb(0, 0, 64);">-</span> left <span style="color: rgb(0, 0, 64);">+</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span>
                        tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">mark</span> <span style="color: rgb(0, 0, 128);">=</span> tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">clr</span> <span style="color: rgb(0, 0, 128);">=</span> tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">tot</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">0</span><span style="color: rgb(0, 128, 128);">;</span>
                        <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span>left <span style="color: rgb(0, 0, 128);">&lt;</span> right<span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">{</span>
                                tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">lch</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 64);">++</span>tot<span style="color: rgb(0, 128, 128);">;</span>
                                build<span style="color: rgb(0, 128, 0);">(</span>left, tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">mid</span>, tot<span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
                                tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">rch</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 64);">++</span>tot<span style="color: rgb(0, 128, 128);">;</span>
                                build<span style="color: rgb(0, 128, 0);">(</span>tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">mid</span> <span style="color: rgb(0, 0, 64);">+</span> <span style="color: rgb(0, 0, 221);">1</span>, right, tot<span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
                        <span style="color: rgb(0, 128, 0);">}</span>
                <span style="color: rgb(0, 128, 0);">}</span>
 
                <span style="color: rgb(0, 0, 255);">void</span> insert<span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 255);">long</span> left, <span style="color: rgb(0, 0, 255);">long</span> right, <span style="color: rgb(0, 0, 255);">long</span> index, <span style="color: rgb(0, 0, 255);">int</span> delta<span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">{</span>
                        <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span>tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">l</span> <span style="color: rgb(0, 0, 128);">&gt;=</span> left <span style="color: rgb(0, 0, 64);">&amp;&amp;</span> tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">r</span> <span style="color: rgb(0, 0, 128);">&lt;=</span> right<span style="color: rgb(0, 128, 0);">)</span> 
                                <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 64);">!</span>tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">mark</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">{</span> <span style="color: rgb(102, 102, 102);">//lazy</span>
                                        tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">clr</span> <span style="color: rgb(0, 0, 64);">+</span><span style="color: rgb(0, 0, 128);">=</span> delta<span style="color: rgb(0, 128, 128);">;</span>
                                        <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span>tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">clr</span> <span style="color: rgb(0, 0, 128);">==</span> <span style="color: rgb(0, 0, 221);">1</span> <span style="color: rgb(0, 0, 64);">&amp;&amp;</span> delta <span style="color: rgb(0, 0, 128);">&gt;</span> <span style="color: rgb(0, 0, 221);">0</span><span style="color: rgb(0, 128, 0);">)</span>
                                                ans <span style="color: rgb(0, 0, 64);">+</span><span style="color: rgb(0, 0, 128);">=</span> tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">all</span><span style="color: rgb(0, 128, 128);">;</span>
                                        <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span>tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">clr</span> <span style="color: rgb(0, 0, 128);">==</span> <span style="color: rgb(0, 0, 221);">0</span> <span style="color: rgb(0, 0, 64);">&amp;&amp;</span> delta <span style="color: rgb(0, 0, 128);">&lt;</span> <span style="color: rgb(0, 0, 221);">0</span><span style="color: rgb(0, 128, 0);">)</span>
                                                ans <span style="color: rgb(0, 0, 64);">+</span><span style="color: rgb(0, 0, 128);">=</span> tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">all</span><span style="color: rgb(0, 128, 128);">;</span>
                                        <span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 128, 128);">;</span>
                                <span style="color: rgb(0, 128, 0);">}</span>
                        <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 64);">!</span>tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">mark</span> <span style="color: rgb(0, 0, 64);">&amp;&amp;</span> tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">all</span> <span style="color: rgb(0, 0, 64);">!</span><span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">{</span> <span style="color: rgb(102, 102, 102);">//下放</span>
                                tree<span style="color: rgb(0, 128, 0);">[</span>tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">lch</span><span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">clr</span> <span style="color: rgb(0, 0, 128);">=</span> tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">clr</span><span style="color: rgb(0, 128, 128);">;</span>
                                tree<span style="color: rgb(0, 128, 0);">[</span>tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">lch</span><span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">mark</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 255);">false</span><span style="color: rgb(0, 128, 128);">;</span>
                                tree<span style="color: rgb(0, 128, 0);">[</span>tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">rch</span><span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">clr</span> <span style="color: rgb(0, 0, 128);">=</span> tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">clr</span><span style="color: rgb(0, 128, 128);">;</span>
                                tree<span style="color: rgb(0, 128, 0);">[</span>tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">rch</span><span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">mark</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 255);">false</span><span style="color: rgb(0, 128, 128);">;</span>
                        <span style="color: rgb(0, 128, 0);">}</span>
                        <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span>tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">all</span> <span style="color: rgb(0, 0, 128);">==</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 0);">)</span> <span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 128, 128);">;</span> <span style="color: rgb(102, 102, 102);">//不递归叶子结点</span>
                        <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span>left <span style="color: rgb(0, 0, 128);">&lt;=</span> tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">mid</span> <span style="color: rgb(0, 0, 64);">&amp;&amp;</span> tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">lch</span> <span style="color: rgb(0, 0, 64);">!</span><span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">0</span><span style="color: rgb(0, 128, 0);">)</span>
                                insert<span style="color: rgb(0, 128, 0);">(</span>left, right, tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">lch</span>, delta<span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span> 
                        <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span>right <span style="color: rgb(0, 0, 128);">&gt;</span> tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">mid</span> <span style="color: rgb(0, 0, 64);">&amp;&amp;</span> tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">rch</span> <span style="color: rgb(0, 0, 64);">!</span><span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">0</span><span style="color: rgb(0, 128, 0);">)</span>
                                insert<span style="color: rgb(0, 128, 0);">(</span>left, right, tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">rch</span>, delta<span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
                        tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">mark</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 255);">true</span><span style="color: rgb(0, 128, 128);">;</span>    <span style="color: rgb(102, 102, 102);">//先归为杂色，因为递归后有可能是杂色</span>
                        <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 64);">!</span>tree<span style="color: rgb(0, 128, 0);">[</span>tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">lch</span><span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">mark</span> <span style="color: rgb(0, 0, 64);">&amp;&amp;</span> <span style="color: rgb(0, 0, 64);">!</span>tree<span style="color: rgb(0, 128, 0);">[</span>tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">rch</span><span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">mark</span> <span style="color: rgb(0, 0, 64);">&amp;&amp;</span> 
                                <span style="color: rgb(0, 128, 0);">(</span>tree<span style="color: rgb(0, 128, 0);">[</span>tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">lch</span><span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">clr</span> <span style="color: rgb(0, 0, 128);">==</span> tree<span style="color: rgb(0, 128, 0);">[</span>tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">rch</span><span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">clr</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">)</span> <span style="color: rgb(102, 102, 102);">//恢复统一色，如果可能</span>
                                tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">mark</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 255);">false</span>, 
                                tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">clr</span> <span style="color: rgb(0, 0, 128);">=</span> tree<span style="color: rgb(0, 128, 0);">[</span>tree<span style="color: rgb(0, 128, 0);">[</span>index<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">lch</span><span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">clr</span><span style="color: rgb(0, 128, 128);">;</span>
                <span style="color: rgb(0, 128, 0);">}
</span><span style="color: rgb(0, 128, 0);">}</span>line<span style="color: rgb(0, 128, 128);">;</span>
 
<span style="color: rgb(0, 0, 255);">int</span> main<span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">{</span>
        <span style="color: rgb(0, 0, 221);">freopen</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(255, 0, 0);">&quot;picture.in&quot;</span>, <span style="color: rgb(255, 0, 0);">&quot;r&quot;</span>, <span style="color: rgb(0, 0, 255);">stdin</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 221);">freopen</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(255, 0, 0);">&quot;picture.out&quot;</span>, <span style="color: rgb(255, 0, 0);">&quot;w&quot;</span>, <span style="color: rgb(0, 0, 255);">stdout</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
        tree<span style="color: rgb(0, 128, 0);">[</span><span style="color: rgb(0, 0, 221);">0</span><span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">mark</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 255);">false</span><span style="color: rgb(0, 128, 128);">;</span>       <span style="color: rgb(102, 102, 102);">//边界条件     </span>
        <span style="color: rgb(0, 0, 221);">cin</span> <span style="color: rgb(0, 0, 128);">&gt;&gt;</span> n<span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 255);">int</span> N2 <span style="color: rgb(0, 0, 128);">=</span> n <span style="color: rgb(0, 0, 64);">*</span> <span style="color: rgb(0, 0, 221);">2</span>, N3 <span style="color: rgb(0, 0, 128);">=</span> n <span style="color: rgb(0, 0, 64);">*</span> <span style="color: rgb(0, 0, 221);">3</span><span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 255);">int</span> i <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span> i <span style="color: rgb(0, 0, 128);">&lt;=</span> n<span style="color: rgb(0, 128, 128);">;</span> i<span style="color: rgb(0, 0, 64);">++</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">{</span>
                <span style="color: rgb(0, 0, 255);">int</span> lx, ly, rx, ry<span style="color: rgb(0, 128, 128);">;</span>
                <span style="color: rgb(0, 0, 221);">scanf</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(255, 0, 0);">&quot;%d%d%d%d&quot;</span>, <span style="color: rgb(0, 0, 64);">&amp;</span>lx, <span style="color: rgb(0, 0, 64);">&amp;</span>ly, <span style="color: rgb(0, 0, 64);">&amp;</span>rx, <span style="color: rgb(0, 0, 64);">&amp;</span>ry<span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
                lx <span style="color: rgb(0, 0, 64);">+</span><span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">10000</span>, ly <span style="color: rgb(0, 0, 64);">+</span><span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">10000</span>, rx <span style="color: rgb(0, 0, 64);">+</span><span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">10000</span>, ry <span style="color: rgb(0, 0, 64);">+</span><span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">10000</span><span style="color: rgb(0, 128, 128);">;</span>
                recv<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">s</span> <span style="color: rgb(0, 0, 128);">=</span> ly, recv<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">t</span> <span style="color: rgb(0, 0, 128);">=</span> ry <span style="color: rgb(0, 0, 64);">-</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span>
                recv<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">vh</span> <span style="color: rgb(0, 0, 128);">=</span> lx, recv<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">start</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 255);">true</span><span style="color: rgb(0, 128, 128);">;</span>
                recv<span style="color: rgb(0, 128, 0);">[</span>i <span style="color: rgb(0, 0, 64);">+</span> n<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">s</span> <span style="color: rgb(0, 0, 128);">=</span> ly, recv<span style="color: rgb(0, 128, 0);">[</span>i <span style="color: rgb(0, 0, 64);">+</span> n<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">t</span> <span style="color: rgb(0, 0, 128);">=</span> ry <span style="color: rgb(0, 0, 64);">-</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span>
                recv<span style="color: rgb(0, 128, 0);">[</span>i <span style="color: rgb(0, 0, 64);">+</span> n<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">vh</span> <span style="color: rgb(0, 0, 128);">=</span> rx, recv<span style="color: rgb(0, 128, 0);">[</span>i <span style="color: rgb(0, 0, 64);">+</span> n<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">start</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 255);">false</span><span style="color: rgb(0, 128, 128);">;</span>
                rech<span style="color: rgb(0, 128, 0);">[</span>i <span style="color: rgb(0, 0, 64);">+</span> N2<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">s</span> <span style="color: rgb(0, 0, 128);">=</span> lx, rech<span style="color: rgb(0, 128, 0);">[</span>i <span style="color: rgb(0, 0, 64);">+</span> N2<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">t</span> <span style="color: rgb(0, 0, 128);">=</span> rx <span style="color: rgb(0, 0, 64);">-</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span>
                rech<span style="color: rgb(0, 128, 0);">[</span>i <span style="color: rgb(0, 0, 64);">+</span> N2<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">vh</span> <span style="color: rgb(0, 0, 128);">=</span> ly, rech<span style="color: rgb(0, 128, 0);">[</span>i <span style="color: rgb(0, 0, 64);">+</span> N2<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">start</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 255);">true</span><span style="color: rgb(0, 128, 128);">;</span>
                rech<span style="color: rgb(0, 128, 0);">[</span>i <span style="color: rgb(0, 0, 64);">+</span> N3<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">s</span> <span style="color: rgb(0, 0, 128);">=</span> lx, rech<span style="color: rgb(0, 128, 0);">[</span>i <span style="color: rgb(0, 0, 64);">+</span> N3<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">t</span> <span style="color: rgb(0, 0, 128);">=</span> rx <span style="color: rgb(0, 0, 64);">-</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span>
                rech<span style="color: rgb(0, 128, 0);">[</span>i <span style="color: rgb(0, 0, 64);">+</span> N3<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">vh</span> <span style="color: rgb(0, 0, 128);">=</span> ry, rech<span style="color: rgb(0, 128, 0);">[</span>i <span style="color: rgb(0, 0, 64);">+</span> N3<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">start</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 255);">false</span><span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 128, 0);">}</span>
        sort<span style="color: rgb(0, 128, 0);">(</span>recvh <span style="color: rgb(0, 0, 64);">+</span> <span style="color: rgb(0, 0, 221);">1</span>, recvh <span style="color: rgb(0, 0, 64);">+</span> N2 <span style="color: rgb(0, 0, 64);">+</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
        sort<span style="color: rgb(0, 128, 0);">(</span>recvh <span style="color: rgb(0, 0, 64);">+</span> N2 <span style="color: rgb(0, 0, 64);">+</span> <span style="color: rgb(0, 0, 221);">1</span>, recvh <span style="color: rgb(0, 0, 64);">+</span> n <span style="color: rgb(0, 0, 64);">+</span> N3 <span style="color: rgb(0, 0, 64);">+</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
        tot <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">1</span>, line.<span style="color: rgb(0, 119, 136);">build</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 221);">0</span>, <span style="color: rgb(0, 0, 221);">20000</span>, <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>   <span style="color: rgb(102, 102, 102);">//纵向的边</span>
        <span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 255);">int</span> i <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span> i <span style="color: rgb(0, 0, 128);">&lt;=</span> N2<span style="color: rgb(0, 128, 128);">;</span> i<span style="color: rgb(0, 0, 64);">++</span><span style="color: rgb(0, 128, 0);">)</span>
                line.<span style="color: rgb(0, 119, 136);">insert</span><span style="color: rgb(0, 128, 0);">(</span>recvh<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">s</span>, recvh<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">t</span>, <span style="color: rgb(0, 0, 221);">1</span>, <span style="color: rgb(0, 128, 0);">(</span>recvh<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">start</span> <span style="color: rgb(0, 128, 128);">?</span> <span style="color: rgb(0, 0, 221);">1</span> <span style="color: rgb(0, 128, 128);">:</span> <span style="color: rgb(0, 0, 64);">-</span><span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 221);">memset</span><span style="color: rgb(0, 128, 0);">(</span>tree, <span style="color: rgb(0, 0, 221);">0</span>, <span style="color: rgb(0, 0, 221);">sizeof</span><span style="color: rgb(0, 128, 0);">(</span>tree<span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
        tot <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">1</span>, line.<span style="color: rgb(0, 119, 136);">build</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 221);">0</span>, <span style="color: rgb(0, 0, 221);">20000</span>, <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>   <span style="color: rgb(102, 102, 102);">//横向的边</span>
        <span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 255);">int</span> i <span style="color: rgb(0, 0, 128);">=</span> N2 <span style="color: rgb(0, 0, 64);">+</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span> i <span style="color: rgb(0, 0, 128);">&lt;=</span> N3 <span style="color: rgb(0, 0, 64);">+</span> n<span style="color: rgb(0, 128, 128);">;</span> i<span style="color: rgb(0, 0, 64);">++</span><span style="color: rgb(0, 128, 0);">)</span>
                line.<span style="color: rgb(0, 119, 136);">insert</span><span style="color: rgb(0, 128, 0);">(</span>recvh<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">s</span>, recvh<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">t</span>, <span style="color: rgb(0, 0, 221);">1</span>, <span style="color: rgb(0, 128, 0);">(</span>recvh<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span>.<span style="color: rgb(0, 119, 136);">start</span> <span style="color: rgb(0, 128, 128);">?</span> <span style="color: rgb(0, 0, 221);">1</span> <span style="color: rgb(0, 128, 128);">:</span> <span style="color: rgb(0, 0, 64);">-</span><span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 221);">cout</span> <span style="color: rgb(0, 0, 128);">&lt;&lt;</span> ans <span style="color: rgb(0, 0, 128);">&lt;&lt;</span> endl<span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 255);">return</span> <span style="color: rgb(0, 0, 221);">0</span><span style="color: rgb(0, 128, 128);">;
</span><span style="color: rgb(0, 128, 0);">}</span></pre></div></div></div></div></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>注意事项</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><font color="#010101" face="宋体">如果排序时出现一样值的情况，要处理优先级。</font></div><div align="justify"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>难易等级</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font><font color="#010101" size="2"><span style="font-size: 10pt;"><b><font face="黑体"> Hard Down(省选 the 2nd)</font></b></span></font></div></div>
</div></body></html> 