<html>
<head>
  <title>USACO 4.1.4 cryptcow</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/268868 (zh-CN); Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="759"/>
<h1>USACO 4.1.4 cryptcow</h1>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="Arial"><span style="font-size:13pt"><b>[</b></span></font><font color="#010101" face="宋体"><span style="font-size:13pt"><b>解题报告</b></span></font> <font color="#010101" face="Arial"><span style="font-size:13pt"><b>]</b></span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="宋体"><span style="font-size:12pt">这到题目很考察思路的条理性，其实剪枝比</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">Fence Rails</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">要容易些，但是编程复杂度要大，因为对于数字来说，字符串的处理很繁杂。但是仔细想一想还是不难解决的。基本思路是枚举</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">'C','O','W',</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">然后迭代删掉选中的</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">&quot;COW&quot;</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">组合，继续直到没有</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">&quot;COW&quot;,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">判断，输出。</span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="宋体"><span style="font-size:12pt">这里有三个优化</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">:<br>
1.</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">因为为了使解的可行性加大，所以我们希望</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">&quot;COW&quot;</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">正好</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">&quot;</span></font> <font color="#010101" face="宋体"><span style="font-size:12pt">包着</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">&quot;</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">加密串，因此搜索顺序应该是先枚举</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">'O'</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">然后是正序的</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">'C'</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">和倒序的</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">'W'.<br>
2.</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">搜索时必定会有一些重复，所以要用散列表判重，经过</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">Gjb</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">神牛测试显示</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">:BKDRhash</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">性能最优，</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">ELFhash</span></font> <font color="#010101" face="宋体"><span style="font-size:12pt">性能最次，冲突很多，所以建议使用</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">BKDRhash</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">或者</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">DJBhash.<br>
3.</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">接着要进行可行性剪枝</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">:</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">因为观察数据，所有的对调都不会影响子串的顺序，所以我们检查每一个被</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">&quot;COW&quot;</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">相隔开的加密串是否是目标串的子串，如果不是则直接剪枝。判断时应该先检查前缀和后缀，然后枚举中缀。</span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="宋体"><span style="font-size:12pt">我以</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">USACO</span></font> <font color="#010101" face="宋体"><span style="font-size:12pt">的</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">#9</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">测试数据为例</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">做了以下测试</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">:<br></span></font><font color="#010101" face="宋体"><span style="font-size:12pt">如果保留</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">hash</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">去掉优化</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">3</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">则运行</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">1.7s,<br></span></font><font color="#010101" face="宋体"><span style="font-size:12pt">如果保留优化</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">3,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">去掉</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">hash</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">则运行</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">5.678s,<br></span></font><font color="#010101" face="宋体"><span style="font-size:12pt">如果都去掉则运行</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">14.4s.<br></span></font><font color="#010101" face="宋体"><span style="font-size:12pt">由上</span></font><font color="#010101" face="Arial"><span style="font-size:12pt">BKDRhash</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">的效果是很显著的</span></font> <font color="#010101" face="Arial"><span style="font-size:12pt">,</span></font><font color="#010101" face="宋体"><span style="font-size:12pt">子串包含检查也很有效。</span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="Arial"><span style="font-size:13pt"><b>[</b></span></font><font color="#010101" face="宋体"><span style="font-size:13pt"><b>运行情况</b></span></font> <font color="#010101" face="Arial"><span style="font-size:13pt"><b>]</b></span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="Arial" size="2"><span style="font-size:10pt">Compiling...<br>
Compile: OK</span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="Arial" size="2"><span style="font-size:10pt">Executing...<br>
   Test 1: TEST OK [0.011 secs, 4392 KB]<br>
   Test 2: TEST OK [0.000 secs, 4392 KB]<br>
   Test 3: TEST OK [0.011 secs, 4392 KB]<br>
   Test 4: TEST OK [0.000 secs, 4392 KB]<br>
   Test 5: TEST OK [0.011 secs, 4392 KB]<br>
   Test 6: TEST OK [0.086 secs, 4392 KB]<br>
   Test 7: TEST OK [0.011 secs, 4392 KB]<br>
   Test 8: TEST OK [0.086 secs, 4392 KB]<br>
   Test 9: TEST OK [0.875 secs, 4392 KB]<br>
   Test 10: TEST OK [0.994 secs, 4392 KB]</span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="Arial" size="2"><span style="font-size:10pt">All tests OK.<br>
Your program ('cryptcow') produced all correct answers! This is your<br>
submission #3 for this problem. </span><span style="font-size:10pt"><b>Congratulations!</b></span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="Arial"><span style="font-size:13pt"><b>[</b></span></font><font color="#010101" face="宋体"><span style="font-size:13pt"><b>程序清单</b></span></font> <font color="#010101" face="Arial"><span style="font-size:13pt"><b>]</b></span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">#include</span></font><font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">&lt;fstream&gt;</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">#include</span></font><font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">&lt;cstring&gt;</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">#define</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">BIG 1500000</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">#define</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">LEN 77</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">using</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">namespace</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">std;</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">const</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">char</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">End[] =</span></font> <font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">&quot;Begin the Escape execution at the Break of Dawn&quot;</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">ofstream fout (</span></font><font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">&quot;cryptcow.out&quot;</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">,ios::out);</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">ifstream fin (</span></font><font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">&quot;cryptcow.in&quot;</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">,ios::in);</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">bool</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">Hash[BIG];</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">long</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">END=0,HASH;</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">char</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">start[LEN],fir[LEN],STR[LEN];</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">inline</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">unsigned</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">long</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">BKDRhash(</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">const</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">char</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">*str){</span></font> <font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//BKDRhash</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">unsigned</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">long</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">seed=131313,hash=0;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">while</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(*str) hash=hash*seed+(*str++);</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">return</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">(hash &amp; 0x7FFFFFFF) % 1000003;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">}</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">inline</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">void</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">change(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">char</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">*str,</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">c,</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">o,</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">w){</span></font> <font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//删掉&quot;COW&quot;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">len=-1;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">    memset(STR,0,</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">sizeof</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(STR));</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">i=0;i&lt;c;i++) STR[++len]=str[i];</span></font> <font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//从0到c</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">i=o+1;i&lt;w;i++) STR[++len]=str[i];</span></font> <font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//从o到w</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">i=c+1;i&lt;o;i++) STR[++len]=str[i];</span></font> <font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//从c到o</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">i=w+1;i&lt;strlen(str);i++) STR[++len]=str[i];</span></font> <font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//从w到最后</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">    strcpy(str,STR);</span></font> <font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//复制回去</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">}</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">inline</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">bool</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">dfscut(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">const</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">char</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">*str){ </span></font> <font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//子串判断剪枝</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">len=-1,Len,i,flag,Flag,lens=strlen(str);</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">while</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(++len&lt;lens &amp;&amp; str[len]!=</span></font> <font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">'C'</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">)</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">(End[len]!=str[len])</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">return</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">true</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">;</span></font> <font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//前缀判断</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">    i=47;Len=len+1;len=lens;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">while</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(len&gt;0 &amp;&amp; str[len-1]!=</span></font> <font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">'W'</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">)</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">(End[--i]!=str[--len])</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">return</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">true</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">;</span></font> <font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//后缀判断</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">    lens=len;len=Len;Len=-1;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">while</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(len&lt;lens){ </span></font> <font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//中缀判断</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">       </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">while</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(++len&lt;lens &amp;&amp; str[len]!=</span></font><font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">'C'</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">&amp;&amp; str[len]!=</span></font> <font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">'O'</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">&amp;&amp; str[len]!=</span></font><font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">'W'</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">)</span></font> <font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//提取子串</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">            fir[++Len]=str[len];</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">        Flag=0;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">       </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(len&lt;=lens)</span></font> <font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//朴素匹配</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">           </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">i=0;i&lt;strlen(End)-Len;i++){</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">                flag=1;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">               </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">j=i;j&lt;=i+Len;j++)</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">                   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(fir[j-i]!=End[j]) {flag=0;</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">break</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">;}</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">               </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(flag) {Flag=1;</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">break</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">;}</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">            }</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">       </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(!Flag)</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">return</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">true</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">        Len=-1;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">    }</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">return</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">false</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">}</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">bool</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">dfs(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">char</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">*str,</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">step){</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">char</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">DFS[LEN];</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">    HASH=BKDRhash(str);</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(Hash[HASH])</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">return</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">false</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">else</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(HASH==END) {fout&lt;&lt;</span></font> <font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">&quot;1 &quot;</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">&lt;&lt;step&lt;&lt;endl;</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">return</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">true</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">;}</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">    Hash[HASH]=</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">true</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(dfscut(str))</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">return</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">false</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">o=0;o&lt;strlen(str);o++)</span></font> <font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//搜索顺序先o后c,w</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">       </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(str[o]==</span></font><font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">'O'</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">)</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">       </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">c=0;c&lt;o;c++)</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">           </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(str[c]==</span></font><font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">'C'</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">)</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">           </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">for</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(</span></font><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">w=strlen(str)-1;w&gt;o;w--)</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">               </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(str[w]==</span></font><font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">'W'</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">){</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">                    strcpy(DFS,str);</span></font> <font color="#008000" face="Times New Roman" size="1"><span style="font-size:9pt">//避免字符串的指针迭代,牺牲时间空间进行复制</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">                    change(DFS,c,o,w);</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">                   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(dfs(DFS,step+1))</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">return</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">true</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">                }</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">return</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">false</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">}</span></font></div><div align="left"><font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">int</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">main(){</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">    memset(Hash,0,</span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">sizeof</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(Hash));</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">    END=BKDRhash(End);</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">    fin.getline(start,LEN+2,</span></font> <font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">'\n'</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">);</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">if</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">(!((strlen(start)-47)%3) &amp;&amp; !dfs(start,0)) fout&lt;&lt;</span></font> <font color="#A31515" face="Times New Roman" size="1"><span style="font-size:9pt">&quot;0 0&quot;</span></font><font face="Times New Roman" size="1"><span style="font-size:9pt">&lt;&lt;endl;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Times New Roman" size="1"><span style="font-size:9pt">return</span></font> <font face="Times New Roman" size="1"><span style="font-size:9pt">0;</span></font></div><div align="left"><font face="Times New Roman" size="1"><span style="font-size:9pt">}</span></font></div></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="Arial"><span style="font-size:13pt"><b>[</b></span></font><font color="#010101" face="宋体"><span style="font-size:13pt"><b>注意事项</b></span></font> <font color="#010101" face="Arial"><span style="font-size:13pt"><b>]</b></span></font></div><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.75mm; margin-bottom:4.75mm;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">避免繁多的字符串指针迭代</span></font> <font color="#010101" face="Arial" size="2"><span style="font-size:10pt">.</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">还是牺牲一下</span></font><font color="#010101" face="Arial" size="2"><span style="font-size:10pt">,</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">拷贝好了</span></font> <font color="#010101" face="Arial" size="2"><span style="font-size:10pt">.(^o^)</span></font></div><div align="justify"><font color="#010101" face="Arial"><span style="font-size:13pt"><b>[</b></span></font><font color="#010101" face="宋体"><span style="font-size:13pt"><b>难易等级</b></span></font><font color="#010101" face="Arial"><span style="font-size:13pt"><b>]</b></span></font><font color="#010101" face="Arial" size="2"><span style="font-size:10pt"><b> Middle UP(noip the 4th)</b></span></font></div></div>
</div></body></html> 