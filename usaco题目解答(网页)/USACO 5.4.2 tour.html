<html>
<head>
  <title>USACO 5.4.2 tour</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/268868 (zh-CN); Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1860"/>
<h1>USACO 5.4.2 tour</h1>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>解题报告</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><div align="left" style="text-indent: 0mm; margin: 4.75mm 0mm;"><font color="#010101" face="宋体" size="4">问题的大意是找到一个回路使得从起点出发必须经过终点然后再次返回起点，途中要求经过尽量多的城市，每个城市只能访问一次。到此为止问题的模型是哈密顿回路，NP难。不过问题又给出了到达终点和返回终点的方向是给定的。这也就是使得问题可以划分阶段，去掉了后效性。我们可以用DP来解决这个问题。</font></div><div align="left" style="text-indent: 0mm; margin: 4.75mm 0mm;"><font color="#010101" face="宋体" size="4">状态转移：<b>DP[i][j] = MAX{DP[i][k] + 1}</b>(如果k和j两个城市连通，同时DP[i][k]非0，也就是存在可行的路径)，方程的意义是：我们让两个路线（往返）同时从起点走，从起点开始到达i和到达j共访问了多少个城市。最后输出的结果就是如果i和终点n存在路径连通那么DP[i][n]中数字最大的那个i就是最终结果了。这个方程的时间复杂度是O(n^3)。</font></div><div align="left" style="text-indent: 0mm; margin: 4.75mm 0mm;"><font color="#010101" face="宋体" size="4">边界条件是<b>DP[1][1] = 1</b>。那么基本上问题就被解决了，现在有个疑问是怎么避免两条路径出现交叉。首先有个性质DP[i][j] = DP[j][i]。这样我们计算一边就可以了，让j &gt;= i。不可以飞向同一个点，这也不符合每个城市访问一次的限制条件，因此不能有等于号，变成j &gt; i。因为方向是确定的，自西向东走，每个阶段都不会走到同一个城市上去也就是DP[i][i]恒为0，也不能自己飞向自己 k != j</font><span style="color: rgb(1, 1, 1); font-family: 宋体; font-size: large; text-indent: 0mm;">。这样k的取值应当是</span><b style="color: rgb(1, 1, 1); font-family: 宋体; font-size: large; text-indent: 0mm;">1 &lt;= k &lt; j 同时 k != i</b><span style="color: rgb(1, 1, 1); font-family: 宋体; font-size: large; text-indent: 0mm;">。这样也就避免了两条路径交叉的情况。使得程序正常工作。</span></div></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>运行情况</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><pre style="text-align: start;"></pre><pre>
Compiling...
Compile: OK

Executing...
   Test 1: TEST OK [0.000 secs, 3564 KB]
   Test 2: TEST OK [0.000 secs, 3564 KB]
   Test 3: TEST OK [0.000 secs, 3564 KB]
   Test 4: TEST OK [0.000 secs, 3564 KB]
   Test 5: TEST OK [0.000 secs, 3564 KB]
   Test 6: TEST OK [0.000 secs, 3564 KB]
   Test 7: TEST OK [0.000 secs, 3564 KB]
   Test 8: TEST OK [0.011 secs, 3564 KB]
   Test 9: TEST OK [0.011 secs, 3564 KB]
   Test 10: TEST OK [0.011 secs, 3564 KB]
   Test 11: TEST OK [0.011 secs, 3564 KB]

All tests OK.
<br><b>YOUR PROGRAM ('tour') WORKED FIRST TIME!</b>  That's fantastic
-- and a rare thing.  Please accept these special automated
congratulations.
</pre></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>程序清单</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><div align="left"><pre style="line-height: 12pt; font-size: 13px; background-color: rgb(255, 255, 236);"></pre><div dir="ltr" lang="zh-cn" style="direction: ltr; text-align: start; font-family: Verdana, Arial, sans-serif;"><div dir="ltr" style="text-align: left;"><div style="font-family: monospace;"><pre style="line-height: 12pt;"></pre><div><pre style="font-size: 13px; line-height: 12pt; background-color: rgb(255, 255, 236);"></pre><pre style="line-height: 12pt;"><span style="color: rgb(51, 153, 0);">#include &lt;iostream&gt;
</span><span style="color: rgb(51, 153, 0);">#include &lt;cstring&gt;
</span><span style="color: rgb(51, 153, 0);">#include &lt;string&gt;
</span><span style="color: rgb(51, 153, 0);">#include &lt;cstdio&gt;
</span><span style="color: rgb(51, 153, 0);">#include &lt;map&gt;</span>
 
<span style="color: rgb(51, 153, 0);">#define MAX(a, b) (a &gt; b ? a : b)</span>
 
<span style="color: rgb(0, 0, 255);">using</span> <span style="color: rgb(0, 0, 255);">namespace</span> std<span style="color: rgb(0, 128, 128);">;</span>
 
<span style="color: rgb(0, 0, 255);">const</span> <span style="color: rgb(0, 0, 255);">long</span> MAXN <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">105</span><span style="color: rgb(0, 128, 128);">;
</span><span style="color: rgb(0, 0, 255);">int</span> n, v, dp<span style="color: rgb(0, 128, 0);">[</span>MAXN<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>MAXN<span style="color: rgb(0, 128, 0);">]</span>, tot<span style="color: rgb(0, 128, 128);">;</span>
map<span style="color: rgb(0, 0, 128);">&lt;</span>string, <span style="color: rgb(0, 0, 255);">int</span><span style="color: rgb(0, 0, 128);">&gt;</span> city<span style="color: rgb(0, 128, 128);">;
</span><span style="color: rgb(0, 0, 255);">bool</span> line<span style="color: rgb(0, 128, 0);">[</span>MAXN<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>MAXN<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 128);">;</span>
 
<span style="color: rgb(0, 0, 255);">int</span> main<span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">{</span>
        <span style="color: rgb(0, 0, 221);">freopen</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(255, 0, 0);">&quot;tour.in&quot;</span>, <span style="color: rgb(255, 0, 0);">&quot;r&quot;</span>, <span style="color: rgb(0, 0, 255);">stdin</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 221);">freopen</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(255, 0, 0);">&quot;tour.out&quot;</span>, <span style="color: rgb(255, 0, 0);">&quot;w&quot;</span>, <span style="color: rgb(0, 0, 255);">stdout</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 221);">cin</span> <span style="color: rgb(0, 0, 128);">&gt;&gt;</span> n <span style="color: rgb(0, 0, 128);">&gt;&gt;</span> v<span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 255);">int</span> i <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span> i <span style="color: rgb(0, 0, 128);">&lt;=</span> n<span style="color: rgb(0, 128, 128);">;</span> i<span style="color: rgb(0, 0, 64);">++</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">{</span>
                string temp<span style="color: rgb(0, 128, 128);">;</span>
                <span style="color: rgb(0, 0, 221);">cin</span> <span style="color: rgb(0, 0, 128);">&gt;&gt;</span> temp<span style="color: rgb(0, 128, 128);">;</span>
                city<span style="color: rgb(0, 128, 0);">[</span>temp<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 128);">=</span> i<span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 128, 0);">}</span>
        <span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 255);">int</span> i <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span> i <span style="color: rgb(0, 0, 128);">&lt;=</span> v<span style="color: rgb(0, 128, 128);">;</span> i<span style="color: rgb(0, 0, 64);">++</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">{</span>
                string a, b<span style="color: rgb(0, 128, 128);">;</span>
                <span style="color: rgb(0, 0, 221);">cin</span> <span style="color: rgb(0, 0, 128);">&gt;&gt;</span> a <span style="color: rgb(0, 0, 128);">&gt;&gt;</span> b<span style="color: rgb(0, 128, 128);">;</span>
                <span style="color: rgb(0, 0, 255);">int</span> x <span style="color: rgb(0, 0, 128);">=</span> city<span style="color: rgb(0, 128, 0);">[</span>a<span style="color: rgb(0, 128, 0);">]</span>, y <span style="color: rgb(0, 0, 128);">=</span> city<span style="color: rgb(0, 128, 0);">[</span>b<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 128);">;</span>
                line<span style="color: rgb(0, 128, 0);">[</span>x<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>y<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 128);">=</span> line<span style="color: rgb(0, 128, 0);">[</span>y<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>x<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 128, 0);">}</span>
        dp<span style="color: rgb(0, 128, 0);">[</span><span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span><span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 255);">int</span> i <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span> i <span style="color: rgb(0, 0, 128);">&lt;</span> n<span style="color: rgb(0, 128, 128);">;</span> i<span style="color: rgb(0, 0, 64);">++</span><span style="color: rgb(0, 128, 0);">)</span>
                <span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 255);">int</span> j <span style="color: rgb(0, 0, 128);">=</span> i <span style="color: rgb(0, 0, 64);">+</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span> j <span style="color: rgb(0, 0, 128);">&lt;=</span> n<span style="color: rgb(0, 128, 128);">;</span> j<span style="color: rgb(0, 0, 64);">++</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">{</span>
                        <span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 255);">int</span> k <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span> k <span style="color: rgb(0, 0, 128);">&lt;</span> j<span style="color: rgb(0, 128, 128);">;</span> k<span style="color: rgb(0, 0, 64);">++</span><span style="color: rgb(0, 128, 0);">)</span>
                                <span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 128, 0);">(</span>line<span style="color: rgb(0, 128, 0);">[</span>k<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>j<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 64);">&amp;&amp;</span> dp<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>k<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 128);">&gt;</span> <span style="color: rgb(0, 0, 221);">0</span><span style="color: rgb(0, 128, 0);">)</span>
                                        dp<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>j<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 128);">=</span> MAX<span style="color: rgb(0, 128, 0);">(</span>dp<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>j<span style="color: rgb(0, 128, 0);">]</span>, dp<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>k<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 64);">+</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
                        dp<span style="color: rgb(0, 128, 0);">[</span>j<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 0, 128);">=</span> dp<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>j<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 128);">;</span>
                <span style="color: rgb(0, 128, 0);">}</span>
        <span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 128, 0);">(</span><span style="color: rgb(0, 0, 255);">int</span> i <span style="color: rgb(0, 0, 128);">=</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 128);">;</span> i <span style="color: rgb(0, 0, 128);">&lt;</span> n<span style="color: rgb(0, 128, 128);">;</span> i<span style="color: rgb(0, 0, 64);">++</span><span style="color: rgb(0, 128, 0);">)</span>
                tot <span style="color: rgb(0, 0, 128);">=</span> MAX<span style="color: rgb(0, 128, 0);">(</span>tot, <span style="color: rgb(0, 128, 0);">(</span>line<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>n<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 128, 128);">?</span> dp<span style="color: rgb(0, 128, 0);">[</span>i<span style="color: rgb(0, 128, 0);">]</span><span style="color: rgb(0, 128, 0);">[</span>n<span style="color: rgb(0, 128, 0);">]</span> <span style="color: rgb(0, 128, 128);">:</span> <span style="color: rgb(0, 0, 221);">0</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 0);">)</span><span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 221);">cout</span> <span style="color: rgb(0, 0, 128);">&lt;&lt;</span> <span style="color: rgb(0, 128, 0);">(</span>tot <span style="color: rgb(0, 0, 128);">&gt;</span> <span style="color: rgb(0, 0, 221);">1</span> <span style="color: rgb(0, 128, 128);">?</span> tot <span style="color: rgb(0, 128, 128);">:</span> <span style="color: rgb(0, 0, 221);">1</span><span style="color: rgb(0, 128, 0);">)</span> <span style="color: rgb(0, 0, 128);">&lt;&lt;</span> endl<span style="color: rgb(0, 128, 128);">;</span>
        <span style="color: rgb(0, 0, 255);">return</span> <span style="color: rgb(0, 0, 221);">0</span><span style="color: rgb(0, 128, 128);">;
</span><span style="color: rgb(0, 128, 0);">}</span></pre></div></div></div></div></div></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>注意事项</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font></div><div align="left" style="text-indent: 0mm; text-align: -webkit-left; margin: 4.75mm 0mm;"><font color="#010101" face="宋体">避免路径交叉</font></div><div align="justify"><font face="黑体"><font color="#010101"><span style="font-size: 13pt;"><b>[</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>难易等级</b></span></font><font color="#010101"><span style="font-size: 13pt;"><b>]</b></span></font></font><font color="#010101" size="2"><span style="font-size: 10pt;"><b><font face="黑体"> Medium Up(noip the 2nd)</font></b></span></font></div><div align="justify"><font color="#010101" size="2"><span style="font-size: 10pt;"><b><font face="黑体"><br></font></b></span></font></div><div align="justify"><div><font color="#010101" style="font-family: 黑体; text-align: -webkit-left;"><span style="font-size: 13pt;"><b>[其他方法</b></span></font><font color="#010101" style="font-family: 黑体; text-align: -webkit-left;"><span style="font-size: 13pt;"><b>]</b></span></font></div><div><font color="#010101" style="font-family: 黑体; text-align: -webkit-left;"><span style="font-size: 13pt;"><b><br></b></span></font></div><div><font color="#010101" style="font-family: 黑体; text-align: -webkit-left;"><span style="font-size: 13pt;"><b>网络流：</b></span></font></div><div><p style="line-height: 12pt; font-family: Verdana, Arial, sans-serif; font-size: 13px; padding-top: 0px; padding-bottom: 0px; margin-top: 1ex; margin-bottom: 0px; text-align: start; background-color: rgb(255, 255, 255);"><b>【建模方法】</b></p><p style="line-height: 12pt; font-family: Verdana, Arial, sans-serif; font-size: 13px; padding-top: 0px; padding-bottom: 0px; margin-top: 1ex; margin-bottom: 0px; text-align: start; background-color: rgb(255, 255, 255);">把第i个城市拆分成两个顶点&lt;i.a&gt;,&lt;i.b&gt;。 1、对于每个城市i，连接(&lt;i.a&gt;,&lt;i.b&gt;)一条容量为1，费用为1的有向边，特殊地(&lt;1.a&gt;,&lt;1.b&gt;)和(&lt;N.a&gt;,&lt;N.b&gt;)容量设为2。 2、如果城市i,j(j&gt;i)之间有航线，从&lt;i.b&gt;到&lt;j.a&gt;连接一条容量为1，费用为0的有向边。 求源&lt;1.a&gt;到汇&lt;N.b&gt;的最大费用最大流。 如果(&lt;1.a&gt;,&lt;1.b&gt;)不是满流，那么无解。否则存在解，即为最大费用最大流量 - 2。</p><p style="line-height: 12pt; font-family: Verdana, Arial, sans-serif; font-size: 13px; padding-top: 0px; padding-bottom: 0px; margin-top: 1ex; margin-bottom: 0px; text-align: start; background-color: rgb(255, 255, 255);"><b>【建模分析】</b></p><p style="line-height: 12pt; font-family: Verdana, Arial, sans-serif; font-size: 13px; padding-top: 0px; padding-bottom: 0px; margin-top: 1ex; margin-bottom: 0px; text-align: start; background-color: rgb(255, 255, 255);">每条航线都是自西向东，本题可以转化为求航线图中从1到N两条不相交的路径，使得路径长度之和最大。转化为网络流模型，就是找两条最长的增广路。由于每个城市只能访问一次，要把城市拆成两个点，之间连接一条容量为1的边，费用设为1。因为要找两条路径，所以起始点和终点内部的边容量要设为2。那么费用流值-2就是两条路径长度之和，为什么减2，因为有两条容量为2的边多算了1的费用。求最大费用最大流后，如果(&lt;1.a&gt;,&lt;1.b&gt;)不是满流，那么我们找到的路径不够2条（可能是1条，也可能0条），所以无解。</p></div></div></div>
</div></body></html> 